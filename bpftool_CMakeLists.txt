# external/bpftool/CMakeLists.txt
# 编译bpftool工具

# 查找依赖
find_program(MAKE_EXECUTABLE make REQUIRED)

# 设置编译命令
add_custom_command(
    OUTPUT ${CMAKE_BINARY_DIR}/bpftool/bin/bpftool
    COMMAND ${MAKE_EXECUTABLE} -j${CMAKE_BUILD_PARALLEL_LEVEL}
    WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
    COMMENT "Building bpftool..."
)

# 添加自定义目标
add_custom_target(bpftool_build DEPENDS ${CMAKE_BINARY_DIR}/bpftool/bin/bpftool)

# 安装目标
install(PROGRAMS ${CMAKE_BINARY_DIR}/bpftool/bin/bpftool DESTINATION bin)