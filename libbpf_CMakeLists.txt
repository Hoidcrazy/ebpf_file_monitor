# external/libbpf/CMakeLists.txt
# 使用libbpf的源码编译静态库

# 设置libbpf源文件
file(GLOB libbpf_src src/*.c)
list(FILTER libbpf_src EXCLUDE REGEX ".*_test\\.c$")

# 创建静态库目标
add_library(libbpf STATIC ${libbpf_src})

# 包含目录
target_include_directories(libbpf 
    PUBLIC 
        $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include>
        $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/src>
)

# 设置编译选项
target_compile_options(libbpf PRIVATE
    -Wno-int-conversion
    -Wno-unused-parameter
    -Wno-sign-compare
    -fPIC
)

# 安装目标
install(TARGETS libbpf DESTINATION lib)
install(DIRECTORY include/ DESTINATION include)